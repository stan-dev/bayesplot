<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>General MCMC diagnostics — MCMC-diagnostics • bayesplot</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.js" integrity="sha256-qoRlVrS5NAnXSSSiMfFXwK8C9obG11Iybe4h2+bQYR4=" crossorigin="anonymous">
  </script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="General MCMC diagnostics — MCMC-diagnostics"><meta name="description" content="Plots of Rhat statistics, ratios of effective sample size to total sample
size, and autocorrelation of MCMC draws. See the Plot Descriptions
section, below, for details. For models fit using the No-U-Turn-Sampler, see
also MCMC-nuts for additional MCMC diagnostic plots."><meta property="og:description" content="Plots of Rhat statistics, ratios of effective sample size to total sample
size, and autocorrelation of MCMC draws. See the Plot Descriptions
section, below, for details. For models fit using the No-U-Turn-Sampler, see
also MCMC-nuts for additional MCMC diagnostic plots."><meta property="og:image" content="https://mc-stan.org/bayesplot/logo.svg"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      bayesplot
    </a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.15.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/posterior">posterior</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstanarm">rstanarm</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org/about/">About Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://bsky.app/profile/did:plc:qznndgdnkem2yryu7ipqbpv7" aria-label="Visit our Bluesky profile"><span class="fa fa-brands fa-bluesky"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/" aria-label="Visit our forums"><span class="fa fa-users"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/bayesplot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>General MCMC diagnostics</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/bayesplot/blob/master/R/mcmc-diagnostics.R" class="external-link"><code>R/mcmc-diagnostics.R</code></a></small>
      <div class="d-none name"><code>MCMC-diagnostics.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Plots of Rhat statistics, ratios of effective sample size to total sample
size, and autocorrelation of MCMC draws. See the <strong>Plot Descriptions</strong>
section, below, for details. For models fit using the No-U-Turn-Sampler, see
also <a href="MCMC-nuts.html">MCMC-nuts</a> for additional MCMC diagnostic plots.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="va">rhat</span>, <span class="va">...</span>, size <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_rhat_hist</span><span class="op">(</span><span class="va">rhat</span>, <span class="va">...</span>, binwidth <span class="op">=</span> <span class="cn">NULL</span>, bins <span class="op">=</span> <span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_rhat_data</span><span class="op">(</span><span class="va">rhat</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="va">ratio</span>, <span class="va">...</span>, size <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_neff_hist</span><span class="op">(</span><span class="va">ratio</span>, <span class="va">...</span>, binwidth <span class="op">=</span> <span class="cn">NULL</span>, bins <span class="op">=</span> <span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_neff_data</span><span class="op">(</span><span class="va">ratio</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_acf</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  regex_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lags <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  size <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_acf_bar</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  regex_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lags <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-rhat">rhat<a class="anchor" aria-label="anchor" href="#arg-rhat"></a></dt>
<dd><p>A vector of R-hat estimates.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Currently ignored.</p></dd>


<dt id="arg-size">size<a class="anchor" aria-label="anchor" href="#arg-size"></a></dt>
<dd><p>Optional values to override <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">ggplot2::geom_point()</a></code>'s
default size (for <code>mcmc_rhat()</code>, <code>mcmc_neff()</code>) or
<code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">ggplot2::geom_line()</a></code>'s default line width (for <code>mcmc_acf()</code>).</p></dd>


<dt id="arg-binwidth">binwidth<a class="anchor" aria-label="anchor" href="#arg-binwidth"></a></dt>
<dd><p>Passed to <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">ggplot2::geom_histogram()</a></code> to override
the default binwidth.</p></dd>


<dt id="arg-bins">bins<a class="anchor" aria-label="anchor" href="#arg-bins"></a></dt>
<dd><p>Passed to <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">ggplot2::geom_histogram()</a></code> to override
the default binwidth.</p></dd>


<dt id="arg-breaks">breaks<a class="anchor" aria-label="anchor" href="#arg-breaks"></a></dt>
<dd><p>Passed to <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">ggplot2::geom_histogram()</a></code> as an
alternative to <code>binwidth</code>.</p></dd>


<dt id="arg-ratio">ratio<a class="anchor" aria-label="anchor" href="#arg-ratio"></a></dt>
<dd><p>A vector of <em>ratios</em> of effective sample size estimates to
total sample size. See <code><a href="bayesplot-extractors.html">neff_ratio()</a></code>.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An object containing MCMC draws:</p><ul><li><p>A 3-D array, matrix, list of matrices, or data frame. The <a href="MCMC-overview.html">MCMC-overview</a>
page provides details on how to specify each these.</p></li>
<li><p>A <code>draws</code> object from the <span class="pkg">posterior</span> package (e.g.,
<code>draws_array</code>, <code>draws_rvars</code>, etc.).</p></li>
<li><p>An object with an <code><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array()</a></code> method that returns the same kind of 3-D
array described on the <a href="MCMC-overview.html">MCMC-overview</a> page.</p></li>
</ul></dd>


<dt id="arg-pars">pars<a class="anchor" aria-label="anchor" href="#arg-pars"></a></dt>
<dd><p>An optional character vector of parameter names. If neither
<code>pars</code> nor <code>regex_pars</code> is specified then the default is to use <em>all</em>
parameters. As of version <code>1.7.0</code>, <strong>bayesplot</strong> also supports 'tidy'
parameter selection by specifying <code>pars = vars(...)</code>, where <code>...</code> is
specified the same way as in <a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select(...)</a> and
similar functions. Examples of using <code>pars</code> in this way can be found on the
<a href="tidy-params.html">Tidy parameter selection</a> page.</p></dd>


<dt id="arg-regex-pars">regex_pars<a class="anchor" aria-label="anchor" href="#arg-regex-pars"></a></dt>
<dd><p>An optional <a href="https://rdrr.io/r/base/grep.html" class="external-link">regular expression</a> to use for
parameter selection. Can be specified instead of <code>pars</code> or in addition to
<code>pars</code>. When using <code>pars</code> for tidy parameter selection, the <code>regex_pars</code>
argument is ignored since <a href="https://tidyselect.r-lib.org/reference/language.html" class="external-link">select helpers</a>
perform a similar function.</p></dd>


<dt id="arg-facet-args">facet_args<a class="anchor" aria-label="anchor" href="#arg-facet-args"></a></dt>
<dd><p>A named list of arguments (other than <code>facets</code>) passed
to <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code> or <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">ggplot2::facet_grid()</a></code>
to control faceting. Note: if <code>scales</code> is not included in <code>facet_args</code>
then <strong>bayesplot</strong> may use <code>scales="free"</code> as the default (depending
on the plot) instead of the <strong>ggplot2</strong> default of <code>scales="fixed"</code>.</p></dd>


<dt id="arg-lags">lags<a class="anchor" aria-label="anchor" href="#arg-lags"></a></dt>
<dd><p>The number of lags to show in the autocorrelation plot.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The plotting functions return a ggplot object that can be further
customized using the <strong>ggplot2</strong> package. The functions with suffix
<code>_data()</code> return the data that would have been drawn by the plotting
function.</p>
    </div>
    <div class="section level2">
    <h2 id="plot-descriptions">Plot Descriptions<a class="anchor" aria-label="anchor" href="#plot-descriptions"></a></h2>


<dl><dt><code>mcmc_rhat()</code>, <code>mcmc_rhat_hist()</code></dt>
<dd><p>Rhat values as either points or a histogram. Values are colored using
different shades (lighter is better). The chosen thresholds are somewhat
arbitrary, but can be useful guidelines in practice.</p><ul><li><p><em>light</em>: below 1.05 (good)</p></li>
<li><p><em>mid</em>: between 1.05 and 1.1 (ok)</p></li>
<li><p><em>dark</em>: above 1.1 (too high)</p></li>
</ul></dd>


<dt><code>mcmc_neff()</code>, <code>mcmc_neff_hist()</code></dt>
<dd><p>Ratios of effective sample size to total sample size as either points or a
histogram. Values are colored using different shades (lighter is better).
The chosen thresholds are somewhat arbitrary, but can be useful guidelines
in practice.</p><ul><li><p><em>light</em>: between 0.5 and 1 (high)</p></li>
<li><p><em>mid</em>: between 0.1 and 0.5 (good)</p></li>
<li><p><em>dark</em>: below 0.1 (low)</p></li>
</ul></dd>


<dt><code>mcmc_acf()</code>, <code>mcmc_acf_bar()</code></dt>
<dd><p>Grid of autocorrelation plots by chain and parameter. The <code>lags</code> argument
gives the maximum number of lags at which to calculate the autocorrelation
function. <code>mcmc_acf()</code> is a line plot whereas <code>mcmc_acf_bar()</code> is a
barplot.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Stan Development Team.
<em>Stan Modeling Language Users Guide and Reference Manual.</em>
<a href="https://mc-stan.org/users/documentation/" class="external-link">https://mc-stan.org/users/documentation/</a></p>
<p>Gelman, A. and Rubin, D. B. (1992). Inference from iterative
simulation using multiple sequences. <em>Statistical Science</em>. 7(4),
457–472.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p>The <a href="https://mc-stan.org/bayesplot/articles/visual-mcmc-diagnostics.html">Visual MCMC Diagnostics</a>
vignette.</p></li>
<li><p><a href="MCMC-nuts.html">MCMC-nuts</a> for additional MCMC diagnostic plots for models fit
using the No-U-Turn-Sampler.</p></li>
</ul><p>Other MCMC:
<code><a href="MCMC-combos.html">MCMC-combos</a></code>,
<code><a href="MCMC-distributions.html">MCMC-distributions</a></code>,
<code><a href="MCMC-intervals.html">MCMC-intervals</a></code>,
<code><a href="MCMC-nuts.html">MCMC-nuts</a></code>,
<code><a href="MCMC-overview.html">MCMC-overview</a></code>,
<code><a href="MCMC-parcoord.html">MCMC-parcoord</a></code>,
<code><a href="MCMC-recover.html">MCMC-recover</a></code>,
<code><a href="MCMC-scatterplots.html">MCMC-scatterplots</a></code>,
<code><a href="MCMC-traces.html">MCMC-traces</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># autocorrelation</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="example-data.html">example_mcmc_draws</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 250   4   4</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Iteration</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Chain</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "chain:1" "chain:2" "chain:3" "chain:4"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "alpha"   "sigma"   "beta[1]" "beta[2]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="bayesplot-colors.html">color_scheme_set</a></span><span class="op">(</span><span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_acf</span><span class="op">(</span><span class="va">x</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta[1]"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="bayesplot-colors.html">color_scheme_set</a></span><span class="op">(</span><span class="st">"pink"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">mcmc_acf_bar</span><span class="op">(</span><span class="va">x</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta[1]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add horiztonal dashed line at 0.5</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="bayesplot-helpers.html">hline_at</a></span><span class="op">(</span><span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">0.15</span>, color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">bayesplot</span> package.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span>   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/stan-dev/bayesplot/issues/&gt;</span>.</span>
<span class="r-plt img"><img src="MCMC-diagnostics-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fake rhat values to use for demonstration</span></span></span>
<span class="r-in"><span><span class="va">rhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">1.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_rhat_hist</span><span class="op">(</span><span class="va">rhat</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `stat_bin()` using `bins = 30`. Pick better value `binwidth`.</span>
<span class="r-plt img"><img src="MCMC-diagnostics-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="va">rhat</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># lollipops</span></span></span>
<span class="r-in"><span><span class="fu"><a href="bayesplot-colors.html">color_scheme_set</a></span><span class="op">(</span><span class="st">"purple"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="va">rhat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="bayesplot-colors.html">color_scheme_set</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">1.07</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">1.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="bayesplot-helpers.html">legend_move</a></span><span class="op">(</span><span class="st">"top"</span><span class="op">)</span> <span class="co"># add legend above plot</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fake neff ratio values to use for demonstration</span></span></span>
<span class="r-in"><span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_neff_hist</span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `stat_bin()` using `bins = 30`. Pick better value `binwidth`.</span>
<span class="r-plt img"><img src="MCMC-diagnostics-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Example using rstanarm model (requires rstanarm package)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/" class="external-link">rstanarm</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: Rcpp</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> This is rstanarm version 2.32.2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - For execution on a local, multicore CPU with excess RAM we recommend calling</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   options(mc.cores = parallel::detectCores())</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># intentionally use small 'iter' so there are some</span></span></span>
<span class="r-in"><span><span class="co"># problems with rhat and neff for demonstration</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html" class="external-link">stan_glm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span>, iter <span class="op">=</span> <span class="fl">50</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The largest R-hat is 1.11, indicating chains have not mixed.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#r-hat</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-in"><span><span class="va">rhats</span> <span class="op">&lt;-</span> <span class="fu"><a href="bayesplot-extractors.html">rhat</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="bayesplot-extractors.html">neff_ratio</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="va">rhats</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="va">ratios</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-12.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># there's a small enough number of parameters in the</span></span></span>
<span class="r-in"><span><span class="co"># model that we can display their names on the y-axis</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="bayesplot-helpers.html">yaxis_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-13.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># can also look at autocorrelation</span></span></span>
<span class="r-in"><span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_acf</span><span class="op">(</span><span class="va">draws</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt"</span>, <span class="st">"cyl"</span><span class="op">)</span>, lags <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-14.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># increase number of iterations and plots look much better</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, iter <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="fu"><a href="bayesplot-extractors.html">rhat</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-15.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="fu"><a href="bayesplot-extractors.html">neff_ratio</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-16.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_acf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt"</span>, <span class="st">"cyl"</span><span class="op">)</span>, lags <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-17.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonah Gabry, Tristan Mahr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

