<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>General MCMC diagnostics — MCMC-diagnostics • bayesplot</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="General MCMC diagnostics — MCMC-diagnostics"><meta property="og:description" content="Plots of Rhat statistics, ratios of effective sample size to total sample
size, and autocorrelation of MCMC draws. See the Plot Descriptions
section, below, for details. For models fit using the No-U-Turn-Sampler, see
also MCMC-nuts for additional MCMC diagnostic plots."><meta property="og:image" content="https://mc-stan.org/bayesplot/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.13.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://mc-stan.org/rstan" class="external-link">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr" class="external-link">cmdstanr</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstanarm" class="external-link">rstanarm</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/projpred" class="external-link">projpred</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools" class="external-link">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior" class="external-link">posterior</a>
    </li>
  </ul></li>
<li>
  <a href="https://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/bayesplot" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>General MCMC diagnostics</h1>
    <small class="dont-index">Source: <a href="https://github.com/stan-dev/bayesplot/blob/HEAD/R/mcmc-diagnostics.R" class="external-link"><code>R/mcmc-diagnostics.R</code></a></small>
    <div class="hidden name"><code>MCMC-diagnostics.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Plots of Rhat statistics, ratios of effective sample size to total sample
size, and autocorrelation of MCMC draws. See the <strong>Plot Descriptions</strong>
section, below, for details. For models fit using the No-U-Turn-Sampler, see
also <a href="MCMC-nuts.html">MCMC-nuts</a> for additional MCMC diagnostic plots.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="va">rhat</span>, <span class="va">...</span>, size <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_rhat_hist</span><span class="op">(</span><span class="va">rhat</span>, <span class="va">...</span>, binwidth <span class="op">=</span> <span class="cn">NULL</span>, bins <span class="op">=</span> <span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_rhat_data</span><span class="op">(</span><span class="va">rhat</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="va">ratio</span>, <span class="va">...</span>, size <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_neff_hist</span><span class="op">(</span><span class="va">ratio</span>, <span class="va">...</span>, binwidth <span class="op">=</span> <span class="cn">NULL</span>, bins <span class="op">=</span> <span class="cn">NULL</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_neff_data</span><span class="op">(</span><span class="va">ratio</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_acf</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  regex_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lags <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  size <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mcmc_acf_bar</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  regex_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lags <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>rhat</dt>
<dd><p>A vector of R-hat estimates.</p></dd>


<dt>...</dt>
<dd><p>Currently ignored.</p></dd>


<dt>size</dt>
<dd><p>Optional values to override <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">ggplot2::geom_point()</a></code>'s
default size (for <code>mcmc_rhat()</code>, <code>mcmc_neff()</code>) or
<code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">ggplot2::geom_line()</a></code>'s default line width (for <code>mcmc_acf()</code>).</p></dd>


<dt>binwidth</dt>
<dd><p>Passed to <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">ggplot2::geom_histogram()</a></code> to override
the default binwidth.</p></dd>


<dt>bins</dt>
<dd><p>Passed to <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">ggplot2::geom_histogram()</a></code> to override
the default binwidth.</p></dd>


<dt>breaks</dt>
<dd><p>Passed to <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">ggplot2::geom_histogram()</a></code> as an
alternative to <code>binwidth</code>.</p></dd>


<dt>ratio</dt>
<dd><p>A vector of <em>ratios</em> of effective sample size estimates to
total sample size. See <code><a href="bayesplot-extractors.html">neff_ratio()</a></code>.</p></dd>


<dt>x</dt>
<dd><p>An object containing MCMC draws:</p><ul><li><p>A 3-D array, matrix, list of matrices, or data frame. The <a href="MCMC-overview.html">MCMC-overview</a>
page provides details on how to specify each these.</p></li>
<li><p>A <code>draws</code> object from the <span class="pkg">posterior</span> package (e.g.,
<code>draws_array</code>, <code>draws_rvars</code>, etc.).</p></li>
<li><p>An object with an <code><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array()</a></code> method that returns the same kind of 3-D
array described on the <a href="MCMC-overview.html">MCMC-overview</a> page.</p></li>
</ul></dd>


<dt>pars</dt>
<dd><p>An optional character vector of parameter names. If neither
<code>pars</code> nor <code>regex_pars</code> is specified then the default is to use <em>all</em>
parameters. As of version <code>1.7.0</code>, <strong>bayesplot</strong> also supports 'tidy'
parameter selection by specifying <code>pars = vars(...)</code>, where <code>...</code> is
specified the same way as in <a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select(...)</a> and
similar functions. Examples of using <code>pars</code> in this way can be found on the
<a href="tidy-params.html">Tidy parameter selection</a> page.</p></dd>


<dt>regex_pars</dt>
<dd><p>An optional <a href="https://rdrr.io/r/base/grep.html" class="external-link">regular expression</a> to use for
parameter selection. Can be specified instead of <code>pars</code> or in addition to
<code>pars</code>. When using <code>pars</code> for tidy parameter selection, the <code>regex_pars</code>
argument is ignored since <a href="https://tidyselect.r-lib.org/reference/language.html" class="external-link">select helpers</a>
perform a similar function.</p></dd>


<dt>facet_args</dt>
<dd><p>A named list of arguments (other than <code>facets</code>) passed
to <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code> or <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">ggplot2::facet_grid()</a></code>
to control faceting. Note: if <code>scales</code> is not included in <code>facet_args</code>
then <strong>bayesplot</strong> may use <code>scales="free"</code> as the default (depending
on the plot) instead of the <strong>ggplot2</strong> default of <code>scales="fixed"</code>.</p></dd>


<dt>lags</dt>
<dd><p>The number of lags to show in the autocorrelation plot.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The plotting functions return a ggplot object that can be further
customized using the <strong>ggplot2</strong> package. The functions with suffix
<code>_data()</code> return the data that would have been drawn by the plotting
function.</p>
    </div>
    <div id="plot-descriptions">
    <h2>Plot Descriptions</h2>
    

<dl><dt><code>mcmc_rhat()</code>, <code>mcmc_rhat_hist()</code></dt>
<dd><p>Rhat values as either points or a histogram. Values are colored using
different shades (lighter is better). The chosen thresholds are somewhat
arbitrary, but can be useful guidelines in practice.</p><ul><li><p><em>light</em>: below 1.05 (good)</p></li>
<li><p><em>mid</em>: between 1.05 and 1.1 (ok)</p></li>
<li><p><em>dark</em>: above 1.1 (too high)</p></li>
</ul></dd>


<dt><code>mcmc_neff()</code>, <code>mcmc_neff_hist()</code></dt>
<dd><p>Ratios of effective sample size to total sample size as either points or a
histogram. Values are colored using different shades (lighter is better).
The chosen thresholds are somewhat arbitrary, but can be useful guidelines
in practice.</p><ul><li><p><em>light</em>: between 0.5 and 1 (high)</p></li>
<li><p><em>mid</em>: between 0.1 and 0.5 (good)</p></li>
<li><p><em>dark</em>: below 0.1 (low)</p></li>
</ul></dd>


<dt><code>mcmc_acf()</code>, <code>mcmc_acf_bar()</code></dt>
<dd><p>Grid of autocorrelation plots by chain and parameter. The <code>lags</code> argument
gives the maximum number of lags at which to calculate the autocorrelation
function. <code>mcmc_acf()</code> is a line plot whereas <code>mcmc_acf_bar()</code> is a
barplot.</p></dd>


</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Stan Development Team.
<em>Stan Modeling Language Users Guide and Reference Manual.</em>
<a href="https://mc-stan.org/users/documentation/" class="external-link">https://mc-stan.org/users/documentation/</a></p>
<p>Gelman, A. and Rubin, D. B. (1992). Inference from iterative
simulation using multiple sequences. <em>Statistical Science</em>. 7(4),
457--472.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<ul><li><p>The <a href="https://mc-stan.org/bayesplot/articles/visual-mcmc-diagnostics.html">Visual MCMC Diagnostics</a>
vignette.</p></li>
<li><p><a href="MCMC-nuts.html">MCMC-nuts</a> for additional MCMC diagnostic plots for models fit
using the No-U-Turn-Sampler.</p></li>
</ul><p>Other MCMC: 
<code><a href="MCMC-combos.html">MCMC-combos</a></code>,
<code><a href="MCMC-distributions.html">MCMC-distributions</a></code>,
<code><a href="MCMC-intervals.html">MCMC-intervals</a></code>,
<code><a href="MCMC-nuts.html">MCMC-nuts</a></code>,
<code><a href="MCMC-overview.html">MCMC-overview</a></code>,
<code><a href="MCMC-parcoord.html">MCMC-parcoord</a></code>,
<code><a href="MCMC-recover.html">MCMC-recover</a></code>,
<code><a href="MCMC-scatterplots.html">MCMC-scatterplots</a></code>,
<code><a href="MCMC-traces.html">MCMC-traces</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># autocorrelation</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="example-data.html">example_mcmc_draws</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 250   4   4</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Iteration</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Chain</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "chain:1" "chain:2" "chain:3" "chain:4"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Parameter</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "alpha"   "sigma"   "beta[1]" "beta[2]"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="bayesplot-colors.html">color_scheme_set</a></span><span class="op">(</span><span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_acf</span><span class="op">(</span><span class="va">x</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta[1]"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="bayesplot-colors.html">color_scheme_set</a></span><span class="op">(</span><span class="st">"pink"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">mcmc_acf_bar</span><span class="op">(</span><span class="va">x</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta[1]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add horiztonal dashed line at 0.5</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="bayesplot-helpers.html">hline_at</a></span><span class="op">(</span><span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">0.15</span>, color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fake rhat values to use for demonstration</span></span></span>
<span class="r-in"><span><span class="va">rhat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span>, <span class="fl">1.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_rhat_hist</span><span class="op">(</span><span class="va">rhat</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>
<span class="r-plt img"><img src="MCMC-diagnostics-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="va">rhat</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># lollipops</span></span></span>
<span class="r-in"><span><span class="fu"><a href="bayesplot-colors.html">color_scheme_set</a></span><span class="op">(</span><span class="st">"purple"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="va">rhat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="bayesplot-colors.html">color_scheme_set</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">1.07</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">1.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="bayesplot-helpers.html">legend_move</a></span><span class="op">(</span><span class="st">"top"</span><span class="op">)</span> <span class="co"># add legend above plot</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fake neff ratio values to use for demonstration</span></span></span>
<span class="r-in"><span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_neff_hist</span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>
<span class="r-plt img"><img src="MCMC-diagnostics-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Example using rstanarm model (requires rstanarm package)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/" class="external-link">rstanarm</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: Rcpp</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> This is rstanarm version 2.32.1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> - For execution on a local, multicore CPU with excess RAM we recommend calling</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   options(mc.cores = parallel::detectCores())</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># intentionally use small 'iter' so there are some</span></span></span>
<span class="r-in"><span><span class="co"># problems with rhat and neff for demonstration</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html" class="external-link">stan_glm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">mtcars</span>, iter <span class="op">=</span> <span class="fl">50</span>, refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>There were 5 divergent transitions after warmup. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The largest R-hat is 1.28, indicating chains have not mixed.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#r-hat</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Markov chains did not converge! Do not analyze results!</span>
<span class="r-in"><span><span class="va">rhats</span> <span class="op">&lt;-</span> <span class="fu"><a href="bayesplot-extractors.html">rhat</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ratios</span> <span class="op">&lt;-</span> <span class="fu"><a href="bayesplot-extractors.html">neff_ratio</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="va">rhats</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="va">ratios</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-12.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># there's a small enough number of parameters in the</span></span></span>
<span class="r-in"><span><span class="co"># model that we can display their names on the y-axis</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="bayesplot-helpers.html">yaxis_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-13.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># can also look at autocorrelation</span></span></span>
<span class="r-in"><span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mcmc_acf</span><span class="op">(</span><span class="va">draws</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt"</span>, <span class="st">"cyl"</span><span class="op">)</span>, lags <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-14.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># increase number of iterations and plots look much better</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, iter <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-in"><span><span class="fu">mcmc_rhat</span><span class="op">(</span><span class="fu"><a href="bayesplot-extractors.html">rhat</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-15.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_neff</span><span class="op">(</span><span class="fu"><a href="bayesplot-extractors.html">neff_ratio</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-16.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">mcmc_acf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt"</span>, <span class="st">"cyl"</span><span class="op">)</span>, lags <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="MCMC-diagnostics-17.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jonah Gabry, Tristan Mahr.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '28ab84fbf0d3f58232875561b9a208cd',
    indexName: 'bayesplot',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

